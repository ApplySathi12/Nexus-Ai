<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Classmate - Advanced 3D AI Tutor</title>
    <script src="https://cdn.tailwindcss.com/"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #020010;
            color: #e0e0e0;
            overflow: hidden; /* Prevent body scroll */
        }
        #three-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .content-section {
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.5s ease-out, visibility 0s 0.5s;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 6rem 1.5rem 2rem;
            overflow-y: auto;
        }
        .content-section.active {
            opacity: 1;
            visibility: visible;
            transition: opacity 0.5s ease-in;
        }
        .feature-card {
            background-color: rgba(23, 18, 43, 0.5);
            border: 1px solid rgba(128, 90, 213, 0.3);
            backdrop-filter: blur(10px);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .feature-card:hover {
            transform: translateY(-10px) scale(1.02);
            box-shadow: 0 0 30px rgba(128, 90, 213, 0.4);
            border-color: rgba(128, 90, 213, 0.7);
        }
        .ai-output {
            background-color: #100c22;
            border-left: 4px solid #805ad5;
            min-height: 150px;
            position: relative;
        }
        .btn-primary {
             background-image: linear-gradient(to right, #805ad5, #d53f8c);
        }
        .btn-primary:hover {
            filter: brightness(1.2);
            box-shadow: 0 0 15px rgba(213, 63, 140, 0.5);
        }
        .btn-secondary {
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn-secondary:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }
        .glassmorphism {
            background: rgba(16, 12, 34, 0.6);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(128, 90, 213, 0.2);
        }
        .copy-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            padding: 0.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            opacity: 0.5;
            transition: opacity 0.2s;
        }
        .ai-output:hover .copy-btn {
            opacity: 1;
        }
        /* Quiz Styles */
        .quiz-option {
            border: 2px solid #4a5568;
            transition: all 0.2s;
        }
        .quiz-option:hover {
            background-color: #4a5568;
            border-color: #805ad5;
        }
        .quiz-option.correct {
            background-color: #38a169;
            border-color: #38a169;
        }
        .quiz-option.incorrect {
            background-color: #e53e3e;
            border-color: #e53e3e;
        }
        .quiz-option.disabled {
            pointer-events: none;
        }
        /* Full-screen modal styles */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 10000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        .modal-content {
            background: linear-gradient(145deg, #1a1a2e, #16213e);
            border: 2px solid rgba(128, 90, 213, 0.5);
            border-radius: 15px;
            padding: 30px;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(128, 90, 213, 0.4);
            position: relative;
            color: #e0e0e0;
            font-family: 'Inter', sans-serif;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(128, 90, 213, 0.3);
            padding-bottom: 15px;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #805ad5;
        }

        .close-btn {
            background: rgba(255, 0, 0, 0.2);
            border: 1px solid rgba(255, 0, 0, 0.5);
            color: #ff6b6b;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: rgba(255, 0, 0, 0.3);
            transform: scale(1.05);
        }

        .modal-body {
            line-height: 1.6;
            font-size: 1rem;
        }

        .modal-body h1, .modal-body h2, .modal-body h3 {
            color: #805ad5;
            margin: 20px 0 15px 0;
        }

        .modal-body p {
            margin-bottom: 15px;
        }

        .modal-body code {
            background: rgba(128, 90, 213, 0.2);
            padding: 2px 6px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
        }

        .modal-body pre {
            background: rgba(0, 0, 0, 0.5);
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            border-left: 4px solid #805ad5;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .spinner {
            border: 4px solid rgba(128, 90, 213, 0.3);
            border-top: 4px solid #805ad5;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .fullscreen-btn {
            background: linear-gradient(135deg, #805ad5, #9f7aea);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            margin-top: 15px;
        }

        .fullscreen-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(128, 90, 213, 0.4);
        }


    </style>
</head>
<body class="antialiased">
    <canvas id="three-canvas"></canvas>

    <!-- Header -->
    <header class="fixed top-0 left-0 right-0 z-50 glassmorphism">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="#" id="home-link" class="flex items-center gap-2 text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-600">
                <img src="https://i.postimg.cc/8Ckfc6bb/Adobe-Express-file.png" alt="Classmate Logo" class="h-8 w-8">
                Classmate
            </a>
            <nav class="hidden md:flex space-x-6 text-sm">
                <a href="#about" class="page-link hover:text-purple-400 transition-colors">About</a>
                <a href="#privacy" class="page-link hover:text-purple-400 transition-colors">Privacy</a>
                <a href="#terms" class="page-link hover:text-purple-400 transition-colors">Terms</a>
            </nav>
            <button class="md:hidden text-white" id="mobile-menu-button">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden px-6 pb-4">
             <a href="#about" class="block py-2 page-link hover:text-purple-400">About Us</a>
             <a href="#privacy" class="block py-2 page-link hover:text-purple-400">Privacy Policy</a>
             <a href="#terms" class="block py-2 page-link hover:text-purple-400">Terms & Conditions</a>
        </div>
    </header>
    
    <main>
        <section id="hero" class="content-section active text-center"><div class="max-w-4xl"><h1 class="text-4xl md:text-6xl font-extrabold mb-4 leading-tight">Your Personal AI Tutor for CBSE</h1><p class="text-lg md:text-xl text-gray-300 mb-8 max-w-3xl mx-auto">Instant doubt solving, smart notes, personalized quizzes, and more. Master your syllabus with the power of AI.</p><button id="get-started-btn" class="btn-primary text-white font-bold py-3 px-8 rounded-full text-lg transition-transform transform hover:scale-105 inline-block">Get Started</button></div></section>
        <section id="features-grid" class="content-section"><div class="container mx-auto"><h2 class="text-3xl md:text-4xl font-bold text-center mb-12">All-in-One AI Toolkit</h2><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8"><div class="feature-card rounded-lg p-6 text-center cursor-pointer" data-feature="doubt-solver"><h3 class="text-xl font-semibold mb-2">AI Doubt Solver</h3><p class="text-gray-400">Get instant, step-by-step solutions for any question, 24/7.</p></div><div class="feature-card rounded-lg p-6 text-center cursor-pointer" data-feature="homework-helper"><h3 class="text-xl font-semibold mb-2">Homework Helper (OCR)</h3><p class="text-gray-400">Snap a picture of your homework and get AI-powered hints and answers.</p></div><div class="feature-card rounded-lg p-6 text-center cursor-pointer" data-feature="smart-notes"><h3 class="text-xl font-semibold mb-2">Smart Notes & Summaries</h3><p class="text-gray-400">Generate concise notes and mind maps from any NCERT chapter.</p></div><div class="feature-card rounded-lg p-6 text-center cursor-pointer" data-feature="quiz-generator"><h3 class="text-xl font-semibold mb-2">AI Practice Quizzes</h3><p class="text-gray-400">Create adaptive MCQs on any topic to master concepts.</p></div><div class="feature-card rounded-lg p-6 text-center cursor-pointer" data-feature="qa-bank"><h3 class="text-xl font-semibold mb-2">Q&A Solution Bank</h3><p class="text-gray-400">Search a vast database of NCERT, exemplar, and past paper questions.</p></div><div class="feature-card rounded-lg p-6 text-center cursor-pointer" data-feature="study-planner"><h3 class="text-xl font-semibold mb-2">Personalized Study Planner</h3><p class="text-gray-400">Let AI create a customized study schedule based on your goals.</p></div></div></div></section>
        <section id="ai-feature-view" class="content-section"><div class="w-full max-w-5xl mx-auto"><div id="ai-feature-container" class="glassmorphism p-6 md:p-8 rounded-lg w-full"></div></div></section>
        <section id="legal-pages-view" class="content-section"><div class="w-full max-w-4xl mx-auto"><div id="legal-page-container" class="glassmorphism p-6 md:p-8 rounded-lg w-full"></div></div></section>
    </main>

    <div id="templates" class="hidden">
        <div class="feature-header flex justify-between items-center mb-6"><h2 class="text-3xl font-bold mt-8 md:mt-0"></h2><button class="btn-secondary text-white font-semibold py-2 px-4 rounded-lg back-to-features-btn">&larr; Back to Tools</button></div>
        <div id="doubt-solver-tpl"><textarea class="w-full bg-[#100c22] p-4 rounded-lg border border-purple-800 focus:outline-none focus:ring-2 focus:ring-purple-500" rows="5" placeholder="Type any question here..."></textarea><div class="flex gap-4 mt-4"><button class="w-full btn-primary text-white font-bold py-3 px-8 rounded-lg ai-submit-btn">Get Solution</button><button class="w-full btn-secondary text-white font-bold py-3 px-8 rounded-lg enhance-prompt-btn">Enhance Prompt</button></div><div class="mt-8 p-6 rounded-lg ai-output overflow-y-auto max-h-[40vh]"></div></div>
        <div id="homework-helper-tpl"><p class="text-gray-400 mb-4">Upload an image of your homework question.</p><input type="file" accept="image/*" class="w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-violet-50 file:text-violet-700 hover:file:bg-violet-100"/><p class="text-xs text-gray-500 mt-2 mb-4">Note: OCR is a placeholder. Please type the question from the image below.</p><textarea class="w-full bg-[#100c22] p-4 rounded-lg border border-purple-800" rows="5" placeholder="After uploading, type the question here..."></textarea><div class="flex gap-4 mt-4"><button class="w-full btn-primary text-white font-bold py-3 px-8 rounded-lg ai-submit-btn">Solve Homework</button><button class="w-full btn-secondary text-white font-bold py-3 px-8 rounded-lg enhance-prompt-btn">Enhance Prompt</button></div><div class="mt-8 p-6 rounded-lg ai-output overflow-y-auto max-h-[40vh]"></div></div>
        <div id="smart-notes-tpl"><textarea class="w-full bg-[#100c22] p-4 rounded-lg border border-purple-800" rows="10" placeholder="Paste a chapter or a long text here to generate notes..."></textarea><div class="flex gap-4 mt-4"><button class="w-full btn-primary text-white font-bold py-3 px-8 rounded-lg ai-submit-btn">Generate Notes</button></div><div class="mt-8 p-6 rounded-lg ai-output overflow-y-auto max-h-[40vh]"></div></div>
        <div id="quiz-generator-tpl"><input type="text" id="quiz-topic-input" class="w-full bg-[#100c22] p-4 rounded-lg border border-purple-800" placeholder="Enter a chapter name (e.g., 'The Fundamental Unit of Life')"><div class="flex gap-4 mt-4"><button class="w-full btn-primary text-white font-bold py-3 px-8 rounded-lg" id="generate-quiz-btn">Generate 25 MCQs</button></div><div id="quiz-container" class="mt-8"></div></div>
        <div id="qa-bank-tpl"><input type="text" class="w-full bg-[#100c22] p-4 rounded-lg border border-purple-800" placeholder="Search for a question from NCERT, exemplars, or past papers..."><div class="flex gap-4 mt-4"><button class="w-full btn-primary text-white font-bold py-3 px-8 rounded-lg ai-submit-btn">Search</button><button class="w-full btn-secondary text-white font-bold py-3 px-8 rounded-lg enhance-prompt-btn">Enhance Search</button></div><div class="mt-8 p-6 rounded-lg ai-output overflow-y-auto max-h-[40vh]"></div></div>
        <div id="study-planner-tpl"><textarea class="w-full bg-[#100c22] p-4 rounded-lg border border-purple-800" rows="5" placeholder="Describe your goal. e.g., 'I need a 7-day plan to revise Physics chapters 1-5 for my unit test. I can study 2 hours daily.'"></textarea><div class="flex gap-4 mt-4"><button class="w-full btn-primary text-white font-bold py-3 px-8 rounded-lg ai-submit-btn">Create My Plan</button></div><div class="mt-8 p-6 rounded-lg ai-output overflow-y-auto max-h-[40vh]"></div></div>
        
        <div id="about-tpl"><div class="feature-header flex justify-between items-center mb-6"><h1 class="text-4xl font-bold mt-8 md:mt-0">About Us</h1><button class="btn-secondary text-white font-semibold py-2 px-4 rounded-lg back-to-home-btn">&larr; Back</button></div><div class="space-y-4 text-gray-300 prose prose-invert max-w-none"><p>Welcome to Classmate, a revolutionary learning platform designed to empower students of Class 9th and 10th. Our mission is to provide every student with a smart, interactive, and personalized digital tutor that makes learning engaging, accessible, and effective.</p><p>We are a passionate team of educators, developers, and AI enthusiasts who believe in the power of technology to transform education. By leveraging the cutting-edge capabilities of Google's Gemini API, we've created a suite of AI-powered tools that cater to the unique learning needs of every student.</p><h4>Our Vision</h4><p>Our vision is to break down the barriers of opportunity in education. We envision a future where every student, regardless of their geographical location or economic background, has access to high-quality educational resources. We want to transform learning from a passive experience into an active, exploratory journey.</p><p>From instant doubt resolution to personalized study plans, our platform is designed to help you master the CBSE syllabus and excel in your exams. Join us on this exciting journey to redefine learning and unlock your full academic potential.</p></div></div>
        <div id="privacy-tpl"><div class="feature-header flex justify-between items-center mb-6"><h1 class="text-4xl font-bold mt-8 md:mt-0">Privacy Policy</h1><button class="btn-secondary text-white font-semibold py-2 px-4 rounded-lg back-to-home-btn">&larr; Back</button></div><div class="space-y-4 text-gray-300 prose prose-invert max-w-none"><p><strong>Last Updated: 20 August 2025</strong></p><p>Your privacy is important to us. This Privacy Policy explains how we collect, use, and protect your information when you use our website.</p><h3 class="text-xl font-semibold pt-4">Information We Collect</h3><ul><li><strong>Anonymized Usage Data:</strong> We may collect data on which features are used, buttons clicked, and session duration. This data is fully anonymous and is used solely to improve our website's performance and user experience.</li><li><strong>AI Interaction Data:</strong> When you use our AI tools (e.g., asking a question in the Doubt Solver), the text or image data you provide is sent directly to the Google Gemini API for processing. We do not store this data on our servers.</li></ul><h3 class="text-xl font-semibold pt-4">How We Use Information</h3><p>The information you provide is used solely to generate a response from the AI model. We do not use this information for any other purpose, such as advertising or user profiling.</p><h3 class="text-xl font-semibold pt-4">Data Security</h3><p>We are committed to ensuring that your information is secure. We use appropriate technical and organizational measures to prevent unauthorized access or disclosure.</p><h3 class="text-xl font-semibold pt-4">Children's Privacy</h3><p>Our service is specifically for students in classes 9 and 10. We do not knowingly collect any personally identifiable information. If a parent or guardian becomes aware that their child has provided us with any information, please contact us.</p><h3 class="text-xl font-semibold pt-4">Changes to This Policy</h3><p>We may update our Privacy Policy from time to time. We will notify you of any changes by posting the new Privacy Policy on this page.</p></div></div>
        <div id="terms-tpl"><div class="feature-header flex justify-between items-center mb-6"><h1 class="text-4xl font-bold mt-8 md:mt-0">Terms and Conditions</h1><button class="btn-secondary text-white font-semibold py-2 px-4 rounded-lg back-to-home-btn">&larr; Back</button></div><div class="space-y-4 text-gray-300 prose prose-invert max-w-none"><p><strong>Last Updated: 20 August 2025</strong></p><p>By accessing and using Classmate, you agree to comply with and be bound by the following terms and conditions.</p><h3 class="text-xl font-semibold pt-4">Use of Service</h3><ol><li>This website is for educational and non-commercial use only.</li><li>You will not use this service for any illegal or unauthorized purpose.</li><li>You will not attempt to generate inappropriate or offensive content from the AI.</li></ol><h3 class="text-xl font-semibold pt-4">AI-Generated Content</h3><p>The solutions and suggestions provided by our AI tools are for educational purposes only. While we strive for accuracy, we do not guarantee the completeness or correctness of the information. You should use the AI-generated content as a learning aid and not as a substitute for your own study and critical thinking.</p><h3 class="text-xl font-semibold pt-4">Limitation of Liability</h3><p>In no event shall Classmate, its directors, or employees be liable for any direct, indirect, or consequential damages arising out of the use of the website.</p><h3 class="text-xl font-semibold pt-4">Changes to Terms</h3><p>We reserve the right to modify these terms and conditions at any time. Your continued use of the website will be considered acceptance of those changes.</p></div></div>
    </div>

    <script type="module">
        // --- Scene Manager ---
        const sceneManager = {
            scene: new THREE.Scene(),
            camera: new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000),
            renderer: new THREE.WebGLRenderer({ canvas: document.getElementById('three-canvas'), alpha: true }),
            objects: new THREE.Group(),
            font: null,
            init() {
                this.renderer.setSize(window.innerWidth, window.innerHeight);
                this.camera.position.z = 50;
                this.scene.add(this.objects);
                const loader = new THREE.FontLoader();
                loader.load('https://threejs.org/examples/fonts/helvetiker_regular.typeface.json', (font) => {
                    this.font = font;
                    this.switchScene('home');
                });
            },
            clearScene() {
                while (this.objects.children.length > 0) { this.objects.remove(this.objects.children[0]); }
                const lights = this.scene.children.filter(obj => obj.isLight);
                lights.forEach(light => this.scene.remove(light));
            },
            switchScene(sceneName) {
                this.clearScene();
                const sceneFn = this.scenes[sceneName] || this.scenes.default;
                sceneFn(this);
            },
            scenes: {
                home: (sm) => {
                    const icons = ['‚öõ', 'üß¨', 'œÄ', 'Œ£', '‚à´', 'üí°', 'üìö', 'üß™'];
                    for (let i = 0; i < 50; i++) {
                        const icon = icons[Math.floor(Math.random() * icons.length)];
                        const geo = new THREE.TextGeometry(icon, { font: sm.font, size: 4, height: 0.5 });
                        geo.center();
                        const mat = new THREE.MeshStandardMaterial({ color: new THREE.Color(`hsl(${Math.random() * 360}, 100%, 75%)`), roughness: 0.5 });
                        const mesh = new THREE.Mesh(geo, mat);
                        const radius = 20 + Math.random() * 20;
                        const angle = Math.random() * Math.PI * 2;
                        const yAngle = Math.random() * Math.PI - Math.PI/2;
                        mesh.position.set(Math.cos(angle) * Math.cos(yAngle) * radius, Math.sin(yAngle) * radius, Math.sin(angle) * Math.cos(yAngle) * radius);
                        mesh.lookAt(new THREE.Vector3(0,0,0));
                        sm.objects.add(mesh);
                    }
                    const ambient = new THREE.AmbientLight(0xffffff, 0.5); sm.scene.add(ambient);
                    const point = new THREE.PointLight(0xffffff, 1); point.position.set(100, 100, 100); sm.scene.add(point);
                },
                'doubt-solver': (sm) => {
                    for (let i = 0; i < 100; i++) {
                        const bulb = new THREE.Group();
                        const bulbGeo = new THREE.SphereGeometry(1, 16, 16);
                        const bulbMat = new THREE.MeshStandardMaterial({ color: 0xffff00, emissive: 0xffff00, emissiveIntensity: 0.8, transparent: true, opacity: 0.5 });
                        const bulbMesh = new THREE.Mesh(bulbGeo, bulbMat);
                        const baseGeo = new THREE.CylinderGeometry(0.5, 0.5, 0.8, 8);
                        const baseMat = new THREE.MeshStandardMaterial({ color: 0x555555 });
                        const baseMesh = new THREE.Mesh(baseGeo, baseMat);
                        baseMesh.position.y = -1.2;
                        bulb.add(bulbMesh);
                        bulb.add(baseMesh);
                        bulb.position.set((Math.random() - 0.5) * 100, (Math.random() - 0.5) * 100, (Math.random() - 0.5) * 100);
                        bulb.scale.setScalar(1 + Math.random());
                        sm.objects.add(bulb);
                    }
                },
                'smart-notes': (sm) => {
                    const points = Array.from({length: 50}, () => new THREE.Vector3((Math.random() - 0.5) * 80, (Math.random() - 0.5) * 80, (Math.random() - 0.5) * 80));
                    const material = new THREE.PointsMaterial({ color: 0xd53f8c, size: 1.5 });
                    sm.objects.add(new THREE.Points(new THREE.BufferGeometry().setFromPoints(points), material));
                    for(let i=0; i<15; i++) {
                        const lineMat = new THREE.LineBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.1 });
                        const lineGeo = new THREE.BufferGeometry().setFromPoints([points[Math.floor(Math.random()*points.length)], points[Math.floor(Math.random()*points.length)]]);
                        sm.objects.add(new THREE.Line(lineGeo, lineMat));
                    }
                },
                'quiz-generator': (sm) => {
                    for (let i = 0; i < 50; i++) {
                        const geo = new THREE.BoxGeometry(5, 5, 5);
                        const mat = new THREE.MeshStandardMaterial({ color: 0x6b46c1, roughness: 0.2 });
                        const mesh = new THREE.Mesh(geo, mat);
                        mesh.position.set((Math.random() - 0.5) * 100, (Math.random() - 0.5) * 100, (Math.random() - 0.5) * 100);
                        mesh.rotation.set(Math.random() * Math.PI, Math.random() * Math.PI, Math.random() * Math.PI);
                        sm.objects.add(mesh);
                    }
                },
                default: (sm) => {
                    const points = Array.from({length: 5000}, () => new THREE.Vector3((Math.random() - 0.5) * 200, (Math.random() - 0.5) * 200, (Math.random() - 0.5) * 200));
                    const geometry = new THREE.BufferGeometry().setFromPoints(points);
                    const material = new THREE.PointsMaterial({ color: 0x4a5568, size: 0.2 });
                    sm.objects.add(new THREE.Points(geometry, material));
                }
            }
        };

        // --- Animation Loop ---
        let mouseX = 0, mouseY = 0;
        function animate() {
            requestAnimationFrame(animate);
            sceneManager.objects.rotation.y += 0.0002 + mouseX;
            sceneManager.objects.rotation.x += 0.0002 + mouseY;
            sceneManager.renderer.render(sceneManager.scene, sceneManager.camera);
        }
        
        // --- Event Listeners and Navigation ---
        document.addEventListener('mousemove', (event) => {
            mouseX = (event.clientX - window.innerWidth / 2) / 15000;
            mouseY = (event.clientY - window.innerHeight / 2) / 15000;
        });
        window.addEventListener('resize', () => {
            sceneManager.camera.aspect = window.innerWidth / window.innerHeight;
            sceneManager.camera.updateProjectionMatrix();
            sceneManager.renderer.setSize(window.innerWidth, window.innerHeight);
        });

        const sections = document.querySelectorAll('.content-section');
        const getStartedBtn = document.getElementById('get-started-btn');
        const featureCards = document.querySelectorAll('.feature-card');
        const pageLinks = document.querySelectorAll('.page-link');
        const homeLink = document.getElementById('home-link');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        const aiFeatureContainer = document.getElementById('ai-feature-container');
        const legalPageContainer = document.getElementById('legal-page-container');

        function showSection(id) {
            sections.forEach(section => section.classList.remove('active'));
            const activeSection = document.getElementById(id);
            if(activeSection) activeSection.classList.add('active');
        }

        getStartedBtn.addEventListener('click', () => { showSection('features-grid'); sceneManager.switchScene('default'); });
        homeLink.addEventListener('click', (e) => { e.preventDefault(); showSection('hero'); sceneManager.switchScene('home'); });
        mobileMenuButton.addEventListener('click', () => mobileMenu.classList.toggle('hidden'));

        featureCards.forEach(card => {
            card.addEventListener('click', () => {
                const featureId = card.dataset.feature;
                const featureTitle = card.querySelector('h3').textContent;
                const template = document.querySelector(`#${featureId}-tpl`).innerHTML;
                const headerTemplate = document.querySelector('.feature-header').cloneNode(true);
                headerTemplate.querySelector('h2').textContent = featureTitle;
                
                aiFeatureContainer.innerHTML = '';
                aiFeatureContainer.appendChild(headerTemplate);
                const contentDiv = document.createElement('div');
                contentDiv.innerHTML = template;
                aiFeatureContainer.appendChild(contentDiv);

                aiFeatureContainer.querySelector('.back-to-features-btn').addEventListener('click', () => { showSection('features-grid'); sceneManager.switchScene('default'); });
                showSection('ai-feature-view');
                sceneManager.switchScene(featureId);
            });
        });
        
        pageLinks.forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const pageId = link.getAttribute('href').substring(1);
                const template = document.querySelector(`#${pageId}-tpl`).innerHTML;
                legalPageContainer.innerHTML = template;
                legalPageContainer.querySelector('.back-to-home-btn').addEventListener('click', () => { showSection('hero'); sceneManager.switchScene('home'); });
                showSection('legal-pages-view');
                sceneManager.switchScene('default');
            });
        });

        // --- Gemini API and UI Interaction (Event Delegation) ---
        let quizData = [];
        let currentQuestionIndex = 0;
        let score = 0;

        document.body.addEventListener('click', async function(event) {
            // AI Submit Button (Non-Quiz)
            if (event.target.classList.contains('ai-submit-btn')) {
                const container = event.target.closest('.glassmorphism');
                const inputElement = container.querySelector('textarea, input[type="text"]');
                const outputElement = container.querySelector('.ai-output');
                const inputValue = inputElement.value.trim();
                if (!inputValue) return;
                outputElement.innerHTML = '<p class="text-center">Generating response, please wait...</p>';
                const featureTitle = container.querySelector('h2').textContent;
                let prompt = createPrompt(featureTitle, inputValue);
                const result = await callGeminiAPIEnhanced(prompt);
                outputElement.innerHTML = marked.parse(result) + `<button class="copy-btn" title="Copy to Clipboard"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg></button>`;
            }
            // Enhance Prompt Button
            if (event.target.classList.contains('enhance-prompt-btn')) {
                const container = event.target.closest('.glassmorphism');
                const inputElement = container.querySelector('textarea, input[type="text"]');
                let userPrompt = inputElement.value.trim();
                if (!userPrompt) return;
                event.target.textContent = 'Enhancing...';
                const enhanceMetaPrompt = `A CBSE student has asked the following question. Rephrase it to be a more detailed and effective prompt for an AI tutor. Return only the enhanced prompt. Original question: "${userPrompt}"`;
                const enhancedPrompt = await callGeminiAPI(enhanceMetaPrompt);
                inputElement.value = enhancedPrompt.replace(/["']/g, ""); // Clean up quotes
                event.target.textContent = 'Enhance Prompt';
            }
            // Copy Button
            if (event.target.closest('.copy-btn')) {
                const button = event.target.closest('.copy-btn');
                const outputElement = button.closest('.ai-output');
                const textToCopy = outputElement.innerText;
                
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                try {
                    document.execCommand('copy');
                    button.innerHTML = 'Copied!';
                    setTimeout(() => {
                        button.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/></svg>`;
                    }, 2000);
                } catch (err) {
                    console.error('Fallback: Oops, unable to copy', err);
                }
                document.body.removeChild(textArea);
            }
            // Generate Quiz Button
            if (event.target.id === 'generate-quiz-btn') {
                const topic = document.getElementById('quiz-topic-input').value.trim();
                if (!topic) return;
                const quizContainer = document.getElementById('quiz-container');
                quizContainer.innerHTML = '<p class="text-center">Generating quiz, please wait...</p>';
                const prompt = `Generate a 25-question multiple-choice quiz on the CBSE chapter "${topic}". For each question, provide 4 options (A, B, C, D), specify the correct answer letter, and a brief explanation for why it's correct. Format the entire output as a single JSON array, where each object has "question", "options" (an array of 4 strings), "answer" (the correct letter e.g., "C"), and "explanation".`;
                const result = await callGeminiAPIEnhanced(prompt);
                try {
                    // Clean the result to be valid JSON
                    const jsonString = result.replace(/```json|```/g, '').trim();
                    quizData = JSON.parse(jsonString);
                    currentQuestionIndex = 0;
                    score = 0;
                    displayQuestion();
                } catch (e) {
                    console.error("Failed to parse quiz JSON:", e);
                    quizContainer.innerHTML = '<p class="text-center text-red-500">Sorry, there was an error creating the quiz. Please try a different topic.</p>';
                }
            }
            // Quiz Option Click
            if (event.target.classList.contains('quiz-option')) {
                handleOptionSelect(event.target);
            }
            // Next Question Button
            if (event.target.id === 'next-question-btn') {
                currentQuestionIndex++;
                displayQuestion();
            }
        });

        function displayQuestion() {
            const quizContainer = document.getElementById('quiz-container');
            if (currentQuestionIndex < quizData.length) {
                const q = quizData[currentQuestionIndex];
                let optionsHTML = q.options.map((opt, index) => {
                    const letter = String.fromCharCode(65 + index);
                    return `<div class="quiz-option p-4 rounded-lg cursor-pointer" data-option="${letter}">${letter}. ${opt}</div>`;
                }).join('');

                quizContainer.innerHTML = `
                    <div class="mb-4 text-gray-400">Question ${currentQuestionIndex + 1} of ${quizData.length}</div>
                    <p class="text-xl font-semibold mb-6">${q.question}</p>
                    <div class="space-y-4">${optionsHTML}</div>
                    <div id="explanation-container" class="mt-6"></div>
                `;
            } else {
                quizContainer.innerHTML = `
                    <h3 class="text-2xl font-bold text-center">Quiz Complete!</h3>
                    <p class="text-center text-xl mt-4">Your Final Score: ${score} out of ${quizData.length}</p>
                `;
            }
        }

        function handleOptionSelect(selectedOptionElement) {
            const selectedAnswer = selectedOptionElement.dataset.option;
            const correctAnswer = quizData[currentQuestionIndex].answer;
            const options = document.querySelectorAll('.quiz-option');

            options.forEach(opt => {
                opt.classList.add('disabled');
                if (opt.dataset.option === correctAnswer) {
                    opt.classList.add('correct');
                }
            });

            if (selectedAnswer === correctAnswer) {
                score++;
            } else {
                selectedOptionElement.classList.add('incorrect');
            }

            const explanationContainer = document.getElementById('explanation-container');
            explanationContainer.innerHTML = `
                <div class="p-4 bg-gray-800 rounded-lg">
                    <p class="font-bold">Explanation:</p>
                    <p>${quizData[currentQuestionIndex].explanation}</p>
                </div>
                <button id="next-question-btn" class="w-full mt-6 btn-primary text-white font-bold py-3 px-8 rounded-lg">Next Question</button>
            `;
        }

        
        function createPrompt(featureTitle, inputValue) {
            const prompts = {
                'AI Doubt Solver': `You are an expert CBSE tutor for classes 9-12. A student asked: "${inputValue}". 

Please provide:
1. **Quick Answer**: Brief, direct answer
2. **Detailed Explanation**: Step-by-step solution with reasoning
3. **Key Concepts**: Important concepts used
4. **Practice Tip**: How to remember or practice this

Use clear markdown formatting with headers, bullet points, and math notation where needed.`,

                'Homework Helper (OCR)': `You are a helpful CBSE tutor. Help solve this homework problem: "${inputValue}".

Please provide:
1. **Problem Analysis**: What type of problem this is
2. **Hints**: 2-3 helpful hints to guide thinking
3. **Step-by-Step Solution**: Complete detailed solution
4. **Key Learning**: What the student should learn from this

Format your response clearly with markdown.`,

                'Smart Notes & Summaries': `Create comprehensive study notes for CBSE students on: "${inputValue}".

Please provide:
1. **Key Points Summary**: Main concepts in bullet points
2. **Detailed Notes**: Organized explanations
3. **Mind Map Structure**: Text-based mind map showing relationships
4. **Important Facts**: Must-remember facts and formulas
5. **Study Tips**: How to effectively learn this topic

Use markdown with headers, lists, and emphasis.`,

                'AI Practice Quizzes': `Create an interactive quiz for CBSE students on: "${inputValue}".

Please provide:
1. **5 Multiple Choice Questions** (A, B, C, D options)
2. **Answer Key**: Correct answers clearly marked
3. **Explanations**: Why each correct answer is right
4. **Difficulty Levels**: Mark as Easy/Medium/Hard
5. **Study Focus**: What to review based on mistakes

Format clearly with numbered questions and proper spacing.`,

                'Q&A Solution Bank': `Search and provide solutions for: "${inputValue}".

Please provide:
1. **Similar Questions**: 3-5 related questions from CBSE/NCERT
2. **Detailed Solutions**: Complete step-by-step solutions
3. **Exam Tips**: How this might appear in exams
4. **Related Topics**: Connected concepts to study
5. **Practice Recommendations**: What to practice next

Use clear formatting and provide comprehensive coverage.`,

                'Personalized Study Planner': `Create a personalized study plan for: "${inputValue}".

Please provide:
1. **Goal Analysis**: Break down the study goal
2. **Timeline**: Suggested study schedule
3. **Daily Tasks**: Specific daily study activities
4. **Resource Recommendations**: Books, chapters, practice materials
5. **Progress Tracking**: How to measure progress
6. **Exam Strategy**: Tips for exam preparation

Create a practical, actionable study plan with clear timelines.`
            };

            return prompts[featureTitle] || `Please help with: "${inputValue}". Provide a detailed, educational response suitable for CBSE students.`;
        }
        
        // --- Initial Load ---
        sceneManager.init();
        animate();
    </script>
    <!-- Full-screen Answer Modal -->
    <div id="answerModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="modalTitle">AI Assistant Answer</h2>
                <button class="close-btn" onclick="closeModal()">‚úï Close</button>
            </div>
            <div class="loading-spinner" id="loadingSpinner">
                <div class="spinner"></div>
                <p>AI is thinking... Please wait</p>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Answer content will be displayed here -->
            </div>
        </div>
    </div>


<script>
// ===== OpenRouter Multi-Model Integration (GPT-5 + DeepSeek) =====
const OPENROUTER_API_KEY = "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"; // <-- put new/regenerated key
const OPENROUTER_URL = "https://openrouter.ai/api/v1/chat/completions";

// Feature -> Model routing
const GPT5_FEATURES = new Set(["smart-notes", "question-answer-solution-bank", "homework-helper"]);
const MODEL_SLUGS = {
  GPT5: "openai/gpt-5",
  DEEPSEEK: "deepseek/deepseek-v3.1"
};

// Utility: set active feature when a feature card is clicked (non-destructive enhancement)
document.addEventListener("click", (e) => {
  const card = e.target.closest?.(".feature-card[data-feature]");
  if (card) {
    const name = card.getAttribute("data-feature");
    const holder = document.querySelector("#ai-feature-container");
    if (holder) holder.setAttribute("data-active-feature", name);
  }
});

// Core caller (non-streaming fallback + simple chunked update if stream available)
async function callOpenRouter(model, prompt, outputEl) {
  const res = await fetch(OPENROUTER_URL, {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${OPENROUTER_API_KEY}`,
      "Content-Type": "application/json",
      "HTTP-Referer": location.origin,
      "X-Title": "Classmate AI Tutor"
    },
    body: JSON.stringify({
      model,
      messages: [{ role: "user", content: prompt }],
      stream: false
    })
  });
  if (!res.ok) throw new Error("OpenRouter error: " + res.status);
  const data = await res.json();
  const text = data?.choices?.[0]?.message?.content || "";
  if (outputEl) outputEl.innerHTML = window.marked ? marked.parse(text) : text;
  return text;
}

// Helper to decide model based on active feature
function pickModelForActiveFeature() {
  const holder = document.querySelector("#ai-feature-container");
  const active = holder?.getAttribute("data-active-feature") || "";
  return GPT5_FEATURES.has(active) ? MODEL_SLUGS.GPT5 : MODEL_SLUGS.DEEPSEEK;
}

// Patch: createPrompt to enforce English + style rules (idempotent)
if (typeof createPrompt !== "function") {
  window.createPrompt = function(featureTitle, inputValue) {
    return `You are a CBSE tutor. The student asked: "${inputValue}".

Answer rules:
- Respond ONLY in English.
- Match the style of the student's request.
- If the student asked for details ‚Üí give step-by-step explanation.
- If the student asked short ‚Üí give a short direct answer.
- DO NOT add greetings, introductions, or summaries.
- Provide only the answer to the question.`;
  };
}

// Global handlers augmentation: route ai-submit-btn via selected model
document.addEventListener("click", async (event) => {
  if (!event.target.classList?.contains("ai-submit-btn")) return;
  const box = event.target.closest(".glassmorphism");
  const inputEl = box?.querySelector("textarea, input[type='text']");
  const outEl = box?.querySelector(".ai-output");
  if (!inputEl || !outEl) return;
  const q = (inputEl.value || "").trim();
  if (!q) return;
  outEl.innerHTML = "<p class='text-center'>Generating...</p>";
  const prompt = createPrompt("Feature", q);
  const model = pickModelForActiveFeature();
  try {
    await callOpenRouter(model, prompt, outEl);
  } catch (e) {
    outEl.innerHTML = "Error generating response.";
    console.error(e);
  }
});

// Enhance Prompt should use DeepSeek (general enhancement), regardless of feature
document.addEventListener("click", async (event) => {
  if (!event.target.classList?.contains("enhance-prompt-btn")) return;
  const btn = event.target;
  const box = btn.closest(".glassmorphism");
  const inputEl = box?.querySelector("textarea, input[type='text']");
  const outEl = box?.querySelector(".ai-output");
  if (!inputEl) return;
  const raw = (inputEl.value || "").trim();
  if (!raw) return;
  btn.disabled = true; const old = btn.textContent; btn.textContent = "Enhancing...";
  const needsDetail = /\\b(detail|details|explain|step by step)\\b/i.test(raw);
  const meta = needsDetail
    ? `Fix spelling/grammar and rephrase this as a detailed CBSE-style question. Return only the improved detailed question. Input: "${raw}"`
    : `Fix spelling/grammar and rephrase this as a clear CBSE exam-style question. Return only the improved question. Input: "${raw}"`;
  try {
    const improved = await callOpenRouter(MODEL_SLUGS.DEEPSEEK, meta, null);
    inputEl.value = improved.replace(/[\"']/g, "").trim();
    if (outEl) outEl.innerHTML = "";
  } catch (e) {
    console.error(e);
  } finally {
    btn.disabled = false; btn.textContent = old;
  }
});
</script>


<script>
// ===== OpenRouter Multi-Model Integration with SSE Streaming =====
const OPENROUTER_API_KEY = "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"; // ‚ö†Ô∏è Replace with your new secure key
const OPENROUTER_URL = "https://openrouter.ai/api/v1/chat/completions";

const GPT5_FEATURES = new Set(["smart-notes", "question-answer-solution-bank", "homework-helper"]);
const MODEL_SLUGS = {
  GPT5: "openai/gpt-5",
  DEEPSEEK: "deepseek/deepseek-v3.1"
};

// SSE streaming function
async function callOpenRouterStream(model, prompt, outputEl) {
  const res = await fetch(OPENROUTER_URL, {
    method: "POST",
    headers: {
      "Authorization": `Bearer ${OPENROUTER_API_KEY}`,
      "Content-Type": "application/json",
      "HTTP-Referer": location.origin,
      "X-Title": "Classmate AI Tutor"
    },
    body: JSON.stringify({
      model,
      messages: [{ role: "user", content: prompt }],
      stream: true
    })
  });

  if (!res.ok) throw new Error("OpenRouter SSE error: " + res.status);

  const reader = res.body.getReader();
  const decoder = new TextDecoder("utf-8");
  outputEl.innerHTML = "";
  let buffer = "";

  while (true) {
    const { value, done } = await reader.read();
    if (done) break;
    buffer += decoder.decode(value, { stream: true });

    const parts = buffer.split("\\n\\n");
    buffer = parts.pop();

    for (const part of parts) {
      if (part.startsWith("data: ")) {
        const data = part.replace("data: ", "").trim();
        if (data === "[DONE]") return;
        try {
          const json = JSON.parse(data);
          const chunk = json.choices?.[0]?.delta?.content;
          if (chunk) {
            outputEl.innerHTML += chunk;
            outputEl.scrollTop = outputEl.scrollHeight;
          }
        } catch (e) {
          console.error("Stream parse error", e);
        }
      }
    }
  }
}

// Select model based on active feature
function pickModelForActiveFeature() {
  const holder = document.querySelector("#ai-feature-container");
  const active = holder?.getAttribute("data-active-feature") || "";
  return GPT5_FEATURES.has(active) ? MODEL_SLUGS.GPT5 : MODEL_SLUGS.DEEPSEEK;
}

// Create prompt with English rules
function createPrompt(featureTitle, inputValue) {
  return `You are a CBSE tutor. The student asked: "${inputValue}".

Answer rules:
- Respond ONLY in English.
- Match the style of the student's request.
- If the student asked for details ‚Üí give step-by-step explanation.
- If the student asked short ‚Üí give a short direct answer.
- DO NOT add greetings, introductions, or summaries.
- Provide only the answer to the question.`;
}

// Ask button -> SSE streaming
document.addEventListener("click", async (event) => {
  if (!event.target.classList?.contains("ai-submit-btn")) return;
  const box = event.target.closest(".glassmorphism");
  const inputEl = box?.querySelector("textarea, input[type='text']");
  const outEl = box?.querySelector(".ai-output");
  if (!inputEl || !outEl) return;

  const q = (inputEl.value || "").trim();
  if (!q) return;

  outEl.innerHTML = "<p class='text-center'>Thinking...</p>";
  const prompt = createPrompt("Feature", q);
  const model = pickModelForActiveFeature();

  try {
    await callOpenRouterStream(model, prompt, outEl);
  } catch (e) {
    outEl.innerHTML = "‚ö†Ô∏è Error: Could not get response.";
    console.error(e);
  }
});

// Enhance Prompt -> DeepSeek only
document.addEventListener("click", async (event) => {
  if (!event.target.classList?.contains("enhance-prompt-btn")) return;
  const btn = event.target;
  const box = btn.closest(".glassmorphism");
  const inputEl = box?.querySelector("textarea, input[type='text']");
  if (!inputEl) return;
  const raw = (inputEl.value || "").trim();
  if (!raw) return;

  btn.disabled = true; const old = btn.textContent; btn.textContent = "Enhancing...";
  const needsDetail = /\\b(detail|details|explain|step by step)\\b/i.test(raw);
  const meta = needsDetail
    ? `Fix spelling/grammar and rephrase this as a detailed CBSE-style question. Return only the improved detailed question. Input: "${raw}"`
    : `Fix spelling/grammar and rephrase this as a clear CBSE exam-style question. Return only the improved question. Input: "${raw}"`;

  const outEl = box?.querySelector(".ai-output");
  if (outEl) outEl.innerHTML = "";

  try {
    await callOpenRouterStream(MODEL_SLUGS.DEEPSEEK, meta, inputEl);
  } catch (e) {
    console.error(e);
  } finally {
    btn.disabled = false; btn.textContent = old;
  }
});
</script>

</body>
</html>
