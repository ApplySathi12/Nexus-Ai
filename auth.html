<meta name='viewport' content='width=device-width, initial-scale=1'/><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus - Login/Signup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- FingerprintJS Script -->
    <script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background-color: #0a0a1a; color: #f0f0f0; }
        .glass-card { /* ... same styles ... */ }
        /* ... other styles ... */
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">

    <a href="index.html" class="text-4xl font-bold text-white mb-8">NEXUS</a>

    <div class="glass-card w-full max-w-md p-8">
        <!-- Tabs and forms -->
        <div id="signup-form" class="hidden space-y-4">
            <!-- ... email and password fields ... -->
            <p class="text-xs text-center text-gray-400">By creating an account, you agree to our 3-day free trial terms.</p>
            <button type="submit" id="signup-btn" class="w-full bg-indigo-600 text-white font-semibold py-3 rounded-lg hover:bg-indigo-700 transition duration-300 flex justify-center items-center">
                <span id="signup-btn-text">Create Free Trial Account</span>
                <div id="signup-spinner" class="hidden animate-spin rounded-full h-5 w-5 border-t-2 border-b-2 border-white"></div>
            </button>
        </div>
        <!-- ... signin form and forgot password ... -->
    </div>
    
    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';
        const supabaseUrl = 'https://mmmaqiqtvkjpwtdlqzrt.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1tbWFxaXF0dmtqcHd0ZGxxenJ0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTY3MDI2MzEsImV4cCI6MjA3MjI3ODYzMX0.TNEIIEAPLGSbGkt1sjH7-Ft5V52a5uIjnYN68EtTbtQ';
        const supabase = createClient(supabaseUrl, supabaseKey);

        const signupForm = document.getElementById('signup-form');
        // ... other element selections ...
        const signupBtn = document.getElementById('signup-btn');
        const signupBtnText = document.getElementById('signup-btn-text');
        const signupSpinner = document.getElementById('signup-spinner');

        // ... existing auth logic ...
        
        signupForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            signupBtn.disabled = true;
            signupBtnText.classList.add('hidden');
            signupSpinner.classList.remove('hidden');

            try {
                // 1. Initialize FingerprintJS
                const fp = await FingerprintJS.load();
                const result = await fp.get();
                const visitorId = result.visitorId;

                // 2. Call the Edge Function with signup details and fingerprint
                const { data, error } = await supabase.functions.invoke('signup-with-trial', {
                    body: {
                        email: document.getElementById('signup-email').value,
                        password: document.getElementById('signup-password').value,
                        fingerprint: visitorId
                    },
                });
                
                if (error) {
                    throw new Error(error.message);
                }
                
                if (!data.success) {
                    throw new Error(data.message);
                }

                showMessage('Sign up successful! Please check your email to verify your account.', false);
            } catch (err) {
                showMessage(err.message || 'An unexpected error occurred.');
            } finally {
                signupBtn.disabled = false;
                signupBtnText.classList.remove('hidden');
                signupSpinner.classList.add('hidden');
            }
        });

        // ... rest of the auth.html logic ...
    </script>
</body>
</html>